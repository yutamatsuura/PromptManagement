# プロンプト一覧・検索ページ E2Eテスト仕様書

生成日: 2026-01-18
対象ページ: `/`
権限レベル: ユーザー（認証必須）

---

## テスト環境

```yaml
URL: http://localhost:3347/
認証: 必須（ProtectedRoute）
テストアカウント:
  email: test@promptmanagement.local
  password: TestPass123!
```

---

## 統合テストでカバー済み（E2Eから除外）

- ✅ CRUD正常系API: `test-prompt-crud.js`
- ✅ 検索フィルタリング（タグAND/OR、全文検索、お気に入り）: `test-prompt-search.js`
- ✅ 全タグ取得API: `test-prompt-search.js`
- ✅ バリデーションエラー: 統合テストでカバー
- ✅ 認証エラー（401）: Supabase RLSで自動処理

---

## E2Eテスト項目一覧（UIフローのみ: 7項目）

| ID | テスト項目 | 期待結果 |
|----|----------|---------|
| E2E-LIST-001 | ページ初期表示フロー | ログイン後、一覧ページが表示され、プロンプトテーブルが正しくレンダリングされる |
| E2E-LIST-002 | テキスト検索フロー | 検索入力 → 検索実行 → 結果表示 → 検索クリア |
| E2E-LIST-003 | タグフィルターフロー | タグ選択 → 結果絞り込み → タグ解除 → 全件表示復帰 |
| E2E-LIST-004 | お気に入り絞り込みフロー | お気に入りボタン → 結果絞り込み → ボタン解除 → 全件表示復帰 |
| E2E-LIST-005 | プロンプトワンクリックコピーフロー | プロンプト本文クリック → コピー成功通知表示 → 2秒後に消える |
| E2E-LIST-006 | 編集フローへの遷移 | 編集ボタンクリック → 編集ページへ遷移（URL変化確認） |
| E2E-LIST-007 | 削除フロー | 削除ボタン → 確認ダイアログ → OK → 一覧から消える |

---

## 詳細テスト手順

### E2E-LIST-001: ページ初期表示フロー

**前提条件**:
- テストユーザーでログイン済み
- プロンプトデータが1件以上存在

**手順**:
1. `/login` にアクセス
2. テストアカウントでログイン
3. `/` (一覧ページ) に自動遷移

**期待結果**:
- ✅ プロンプト一覧テーブルが表示される
- ✅ ヘッダーに「★ / タイトル / プロンプト / タグ / 操作」列が表示
- ✅ 検索・フィルターセクション（Accordion）が表示される
- ✅ 既存プロンプトが1件以上表示される

---

### E2E-LIST-002: テキスト検索フロー

**前提条件**:
- ページ初期表示完了
- 検索可能なプロンプトが複数存在

**手順**:
1. 検索・フィルターセクションを展開
2. テキスト検索欄に「データベース」と入力
3. 結果が自動絞り込まれることを確認
4. 検索欄をクリア（空文字）
5. 全件表示に戻ることを確認

**期待結果**:
- ✅ 「データベース」を含むプロンプトのみ表示される
- ✅ 検索クリア後、全件表示に戻る
- ✅ ローディング状態なし（リアルタイム絞り込み）

---

### E2E-LIST-003: タグフィルターフロー

**前提条件**:
- ページ初期表示完了
- 複数のタグを持つプロンプトが存在

**手順**:
1. 検索・フィルターセクションを展開
2. タグ「AI」をクリック
3. 結果が絞り込まれることを確認
4. タグ「プログラミング」を追加クリック（複数選択）
5. 結果がさらに絞り込まれることを確認
6. タグ「AI」を再度クリック（解除）
7. 「プログラミング」のみのフィルタになることを確認
8. タグ「プログラミング」を再度クリック（全解除）
9. 全件表示に戻ることを確認

**期待結果**:
- ✅ 選択されたタグが青色（active）になる
- ✅ 複数タグ選択時、OR検索で絞り込まれる
- ✅ タグ解除で即座に結果が変わる
- ✅ 全解除で全件表示に戻る

---

### E2E-LIST-004: お気に入り絞り込みフロー

**前提条件**:
- ページ初期表示完了
- お気に入りプロンプトが1件以上存在

**手順**:
1. 検索・フィルターセクションを展開
2. 「★ お気に入りのみ」ボタンをクリック
3. お気に入りプロンプトのみ表示されることを確認
4. 「★ お気に入りのみ」ボタンを再度クリック（解除）
5. 全件表示に戻ることを確認

**期待結果**:
- ✅ ボタンがactive状態（青背景）になる
- ✅ お気に入り（★マーク付き）のみ表示される
- ✅ ボタン解除で全件表示に戻る

---

### E2E-LIST-005: プロンプトワンクリックコピーフロー

**前提条件**:
- ページ初期表示完了
- HTTPS環境（localhost除く）またはlocalhost

**手順**:
1. 任意のプロンプト本文セル（プロンプト列）をクリック
2. Snackbar（成功通知）が表示されることを確認
3. 2秒待つ
4. Snackbarが自動で消えることを確認

**期待結果**:
- ✅ セルの背景色が一時的に変わる（#004A6C）
- ✅ 画面下部中央に「コピーしました」通知が表示
- ✅ 2秒後に通知が自動で消える
- ✅ クリップボードにプロンプト本文がコピーされている

**注意**:
- Clipboard APIはHTTPS環境またはlocalhostでのみ動作

---

### E2E-LIST-006: 編集フローへの遷移

**前提条件**:
- ページ初期表示完了
- 編集可能なプロンプトが1件以上存在

**手順**:
1. 任意のプロンプトの「編集」ボタンをクリック
2. URLが `/prompts/edit/:id` に変化することを確認
3. 編集ページが表示されることを確認

**期待結果**:
- ✅ `/prompts/edit/:id` に遷移
- ✅ 編集フォームが表示される
- ✅ プロンプトデータが自動入力されている

---

### E2E-LIST-007: 削除フロー

**前提条件**:
- ページ初期表示完了
- 削除可能なプロンプトが1件以上存在

**手順**:
1. 任意のプロンプトの「削除」ボタンをクリック
2. 確認ダイアログが表示されることを確認
3. ダイアログで「OK」をクリック
4. プロンプトが一覧から消えることを確認

**期待結果**:
- ✅ `window.confirm` ダイアログが表示される
- ✅ ダイアログメッセージに「[タイトル]を削除してもよろしいですか?」が含まれる
- ✅ OK後、一覧から該当プロンプトが即座に消える
- ✅ データベースからも削除される（再読み込みで確認）

**異常系**:
- キャンセルクリック時、削除されず一覧に残る

---

## 実行コマンド

```bash
npx playwright test tests/e2e/prompt-list.spec.ts
```

---

## 品質確認チェックリスト

| 確認項目 | チェック |
|---------|---------|
| E2E項目数が5-10項目以内か？ | ✅ 7項目 |
| 統合テストカバレッジを確認したか？ | ✅ |
| CRUD正常系APIを除外したか？ | ✅ |
| 検索フィルタリングAPIを除外したか？ | ✅ |
| フロー単位で設計したか？ | ✅ |
| UIを通じた操作のみをテストしているか？ | ✅ |

---

## 備考

**統合テストとの役割分担**:
- **統合テスト**: APIの動作保証（CRUD、検索、フィルタリング）
- **E2Eテスト**: UIの動作保証（表示、操作、遷移、フィードバック）

**E2Eの焦点**:
- ユーザーが実際にUIを操作して目的を達成できるか
- UI要素（ボタン、テーブル、Snackbar）が正しく動作するか
- ページ遷移が正しく機能するか

**重複排除**:
- API呼び出しの正常性は統合テストで保証済み
- E2EはUIレイヤーのみに焦点を当てる
