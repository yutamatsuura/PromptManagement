# ログイン/新規登録ページ E2Eテスト仕様書

生成日: 2026-01-18
対象ページ: `/login`
権限レベル: ゲスト

---

## テスト環境

```yaml
URL: http://localhost:3347/login
認証: 不要（ゲスト専用ページ）
テストアカウント:
  email: test@promptmanagement.local
  password: TestPass123!
```

---

## 統合テストでカバー済み（E2Eから除外）

**注意**: PromptManagementプロジェクトではバックエンドにSupabase（BaaS）を使用しているため、バックエンド統合テストは存在しません。
- ✅ 認証エラー（401）: Supabase Authが自動処理
- ✅ バリデーション（400）: Supabase Authが自動処理
- ✅ 認証API正常系: Supabase Authが自動処理

---

## E2Eテスト項目一覧（UIフローのみ: 7項目）

| ID | テスト項目 | 期待結果 |
|----|----------|---------|
| E2E-LOGIN-001 | ページ表示 | ログインフォームとタブ（ログイン/新規登録）が表示される |
| E2E-LOGIN-002 | ログインフロー | メールとパスワードを入力 → ログインボタンクリック → ダッシュボード（/）へリダイレクト |
| E2E-LOGIN-003 | 新規登録フロー | タブ切替（新規登録） → メールとパスワードを入力 → 登録ボタンクリック → 確認メッセージ表示 |
| E2E-LOGIN-004 | パスワードリセットフロー | 「パスワードを忘れた」リンククリック → メール入力 → リセットメール送信完了メッセージ表示 |
| E2E-LOGIN-005 | 入力フィールドバリデーション表示 | 空フィールドでログイン試行 → エラーメッセージが各フィールド下に表示される |
| E2E-LOGIN-006 | パスワード表示切替 | パスワードフィールドの「目」アイコンクリック → テキスト表示切替動作 |
| E2E-LOGIN-007 | ログイン済みユーザーのリダイレクト | ログイン済み状態で/loginにアクセス → ダッシュボード（/）へ自動リダイレクト |

---

## テスト詳細

### E2E-LOGIN-001: ページ表示
**ユーザーゴール**: ログインページが正しく表示されることを確認
**操作手順**:
1. ブラウザで `http://localhost:3347/login` にアクセス
2. ページの読み込み完了を待機

**検証項目**:
- タブ「ログイン」と「新規登録」が表示される
- メールアドレス入力フィールドが表示される
- パスワード入力フィールドが表示される
- ログインボタンが表示される
- 「パスワードを忘れた方はこちら」リンクが表示される

---

### E2E-LOGIN-002: ログインフロー
**ユーザーゴール**: 既存ユーザーがログインできる
**操作手順**:
1. メールアドレスフィールドに `test@promptmanagement.local` を入力
2. パスワードフィールドに `TestPass123!` を入力
3. 「ログイン」ボタンをクリック
4. 画面遷移を待機

**検証項目**:
- URLが `http://localhost:3347/` に変更される
- ダッシュボード（プロンプト一覧ページ）が表示される
- ヘッダーにログアウトボタンが表示される

---

### E2E-LOGIN-003: 新規登録フロー
**ユーザーゴール**: 新規ユーザーがアカウントを作成できる
**操作手順**:
1. 「新規登録」タブをクリック
2. メールアドレスフィールドに新しいメールアドレス（例: `newuser@test.local`）を入力
3. パスワードフィールドにパスワード（例: `NewPass123!`）を入力
4. 「登録」ボタンをクリック
5. 確認メッセージ表示を待機

**検証項目**:
- 登録成功メッセージ（「確認メールを送信しました」など）が表示される
- （または）ダッシュボードへ自動ログイン・リダイレクトされる

**注意**: このテストはテストデータクリーンアップが必要な場合があります

---

### E2E-LOGIN-004: パスワードリセットフロー
**ユーザーゴール**: パスワードを忘れたユーザーがリセットメールを受け取れる
**操作手順**:
1. 「パスワードを忘れた方はこちら」リンクをクリック
2. モーダルまたはフォームが表示される
3. メールアドレスフィールドに `test@promptmanagement.local` を入力
4. 「リセットメールを送信」ボタンをクリック
5. 完了メッセージ表示を待機

**検証項目**:
- リセットメール送信完了メッセージ（「パスワードリセットメールを送信しました」など）が表示される
- フォームがクリアされる（または閉じる）

---

### E2E-LOGIN-005: 入力フィールドバリデーション表示
**ユーザーゴール**: 入力が不正な場合にエラーメッセージが表示される
**操作手順**:
1. メールアドレスフィールドを空のまま
2. パスワードフィールドを空のまま
3. 「ログイン」ボタンをクリック

**検証項目**:
- メールアドレスフィールドの下にエラーメッセージ（「メールアドレスを入力してください」など）が表示される
- パスワードフィールドの下にエラーメッセージ（「パスワードを入力してください」など）が表示される
- URLが `/login` のまま変わらない

---

### E2E-LOGIN-006: パスワード表示切替
**ユーザーゴール**: パスワードの表示・非表示を切り替えられる
**操作手順**:
1. パスワードフィールドに `test` と入力
2. パスワードフィールド右側の「目」アイコンをクリック
3. 再度「目」アイコンをクリック

**検証項目**:
- 1回目のクリック後、パスワードが平文（`test`）で表示される
- 2回目のクリック後、パスワードが `****` 形式で非表示になる

---

### E2E-LOGIN-007: ログイン済みユーザーのリダイレクト
**ユーザーゴール**: ログイン済みユーザーが `/login` にアクセスした場合、ダッシュボードにリダイレクトされる
**操作手順**:
1. 既にログイン済みの状態を準備（E2E-LOGIN-002実行後など）
2. ブラウザで `http://localhost:3347/login` に直接アクセス
3. リダイレクトを待機

**検証項目**:
- URLが `http://localhost:3347/` に自動的に変更される
- ダッシュボード（プロンプト一覧ページ）が表示される
- ログインフォームが表示されない

---

## 実行コマンド

```bash
npx playwright test tests/e2e/login.spec.ts
```

---

## 備考

**テストデータクリーンアップ**:
- E2E-LOGIN-003（新規登録）実行後、テストユーザーをSupabase Admin Consoleから削除することを推奨
- または、テスト専用の一時メールアドレス（例: `test+TIMESTAMP@test.local`）を使用

**Supabase依存**:
- このテストはSupabaseのクラウドサービス（本番環境）を使用します
- インターネット接続が必要です
- Supabase Authの遅延により、待機時間が必要な場合があります

**並列実行の制限**:
- E2E-LOGIN-002とE2E-LOGIN-007は同じセッションを使用するため、並列実行できません
- テストは順次実行を推奨します
